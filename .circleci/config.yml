version: 2.1

orbs:
  node: circleci/node@5.1.0
  python: circleci/python@2.1.1
# Define a job to be invoked later in a workflow.
jobs:
  test-apps:
    # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
    docker:
      - image: cimg/python:3.11

    # Add steps to the job
    steps:
      - checkout
      - python/install-packages:
          pkg-manager: pip
          pip-dependency-file: backend/requirements.txt

      # - run: python backend/manage.py test authentication
      # - run: python backend/manage.py test mail_serv
      # - run: python backend/manage.py test authentication
      # - run: python backend/manage.py test authentication

      - run:
          name: Test Authentication App
          command: python backend/manage.py test authentication
      - run:
          name: Test Mail Serv App
          command: python backend/manage.py test mail_serv
      - run:
          name: Test Event Management App
          command: python backend/manage.py test event_management

      - node/install-packages:
          pkg-manager: npm
          app-dir: frontend
      - run: npm test
      # - run:
      #     name: Install Django dependencies
      #     command: pip install -r backend/requirements.txt
      # Django Tests
      # - run:
      #     name: Test Authentication App
      #     command: python backend/manage.py test authentication
      # - run:
      #     name: Test Mail Serv App
      #     command: python backend/manage.py test mail_serv
      # - run:
      #     name: Test Event Management App
      #     command: python backend/manage.py test event_management
      # Node Tests
      # - run:
      #     name: Install Node.js dependencies
      #     command: cd frontend && npm install
      # - run: 
      #     name: Test Frontend
      #     command: cd frontend && npm test

# Orchestrate jobs using workflows
workflows:
  app-workflow:
    jobs:
      - test-apps
